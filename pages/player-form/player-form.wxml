<wxs src="./player-form.wxs" module="utils" />
<view class="container">
  <form bindsubmit="submitForm">
    <!-- 基本信息 -->
    <view class="card">
      <view class="card-title">基本信息</view>

      <!-- 姓名和号码并排 -->
      <view class="name-number-row">
        <view class="form-group name-number-item">
          <text class="form-label"><text class="required-mark">*</text>球员姓名</text>
          <input class="form-input" name="name" value="{{formData.name}}" placeholder="请输入真实姓名" bindinput="onInput" data-field="name"/>
        </view>
        <view class="form-group name-number-item">
          <text class="form-label"><text class="required-mark">*</text>球衣号码</text>
          <input class="form-input" type="number" name="number" value="{{formData.number}}" placeholder="1-99号" maxlength="2" bindinput="onInput" data-field="number"/>
        </view>
      </view>

      <view class="form-group">
        <text class="form-label"><text class="required-mark">*</text>位置</text>
        <view class="position-tags">
          <view class="position-tag {{utils.includes(formData.position, item) ? 'active' : ''}}"
                wx:for="{{positionOptions}}"
                wx:key="*this"
                bindtap="togglePosition"
                data-position="{{item}}">
            {{item}}
          </view>
        </view>
      </view>

      <!-- 加入日期和性别并排 -->
      <view class="join-gender-row">
        <view class="form-group join-gender-item">
          <text class="form-label">加入日期</text>
          <picker mode="date" bindchange="onDateChange">
            <view class="form-picker">
              {{formData.joinDate || '请选择日期'}}
            </view>
          </picker>
        </view>
        <view class="form-group join-gender-item">
          <text class="form-label">性别</text>
          <picker bindchange="onGenderChange" value="{{genderIndex}}" range="{{genders}}">
            <view class="form-picker">
              {{formData.gender || '请选择'}}
            </view>
          </picker>
        </view>
      </view>

      <!-- 年龄和身高并排 -->
      <view class="age-height-row">
        <view class="form-group age-height-item">
          <text class="form-label">年龄</text>
          <picker mode="selector" range="{{ageRange}}" bindchange="onAgeChange">
            <view class="form-picker">
              {{formData.age ? formData.age + '岁' : '请选择'}}
            </view>
          </picker>
        </view>
        <view class="form-group age-height-item">
          <text class="form-label">身高 (cm)</text>
          <picker mode="selector" range="{{heightRange}}" bindchange="onHeightChange">
            <view class="form-picker">
              {{formData.height || '请选择'}}
            </view>
          </picker>
        </view>
      </view>

      <!-- 体重单独一行 -->
      <view class="form-group">
        <text class="form-label">体重 (kg)</text>
        <picker mode="selector" range="{{weightRange}}" bindchange="onWeightChange">
          <view class="form-picker">
            {{formData.weight || '请选择'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">头像</text>
        <view class="avatar-upload" bindtap="chooseAvatar">
          <image wx:if="{{formData.avatar}}" src="{{formData.avatar}}" mode="aspectFill" class="avatar-preview"></image>
          <view wx:else class="avatar-placeholder">
            <text>+</text>
            <text>上传</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 球员标签 -->
    <view class="card">
      <view class="card-title">球员标签</view>
      <view class="tag-list">
        <view class="tag-item {{utils.includes(formData.tags, item.value) ? 'active' : ''}}"
              wx:for="{{allTagsWithCustom}}"
              wx:key="value"
              bindtap="{{item.isCustom ? 'toggleCustomTag' : 'toggleTag'}}"
              data-value="{{item.value}}">
          {{item.label}}
        </view>
        <!-- 添加自定义标签按钮 -->
        <view class="tag-item add-tag-btn" bindtap="showAddTagDialog">+</view>
      </view>
    </view>

    <!-- 能力值 -->
    <view class="card">
      <view class="card-title">能力值 (1-100)</view>
      <view class="ability-form">
        <view class="ability-form-item" wx:for="{{abilityConfig}}" wx:key="key">
          <view class="ability-header">
            <text class="ability-icon">{{item.icon}}</text>
            <text class="ability-name">{{item.label}}</text>
            <text class="ability-value">{{formData.ability[item.key] || 0}}</text>
          </view>
          <slider class="ability-slider"
                  min="0"
                  max="100"
                  step="5"
                  value="{{formData.ability[item.key] || 0}}"
                  activeColor="#1989fa"
                  bindchange="onAbilityChange"
                  data-field="{{item.key}}"/>
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="btn-container">
      <button class="btn btn-primary btn-block" form-type="submit">{{isEdit ? '保存修改' : '添加球员'}}</button>
    </view>
  </form>
</view>

<!-- 自定义标签弹窗 -->
<view class="dialog-mask" wx:if="{{showDialog}}" bindtap="hideDialog"></view>
<view class="dialog" wx:if="{{showDialog}}">
  <view class="dialog-title">添加自定义标签</view>
  <view class="dialog-content">
    <input class="dialog-input" placeholder="请输入标签名称" maxlength="10" bindinput="onTagInput" value="{{newTagName}}"/>
  </view>
  <view class="dialog-actions">
    <view class="dialog-btn cancel" bindtap="hideDialog">取消</view>
    <view class="dialog-btn confirm" bindtap="confirmAddTag">确定</view>
  </view>
</view>
